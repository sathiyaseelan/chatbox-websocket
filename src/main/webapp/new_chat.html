<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Chat - Customer Module</title>
<link type="text/css" rel="stylesheet" href="style.css" />
<link type="text/css" rel="stylesheet" href="login.css" />
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>
<script type="text/javascript">


	var ws;
	
	function connect()
	{
	name = document.getElementById("user_name").value;
	button_value = document.getElementById("exit").text;
	if(button_value === "Exit Chat"){
		ws.close();
		document.getElementById("exit").text = "Enter Chat";
		document.getElementById("display_name").innerText = "";
		document.getElementById("user_name").style.display = "block";
	}
	else if (name && "WebSocket" in window)
    {
       
      // Let us open a web socket
      ws = new WebSocket("ws://localhost:8080/ws/chat?name="+name);
      document.getElementById("display_name").innerText = name;
      document.getElementById("exit").text = "Exit Chat";
      document.getElementById("user_name").style.display = "none";
    }else
    	alert("Web socket is not supported or name is empty");
		
		ws.onopen = function()
    {
       // Web Socket is connected, send data using send()
       //alert("Connected");
       
    };
		
    ws.onmessage = function (evt) 
    { 
       var received_msg = evt.data;
       document.getElementById("chatbox").innerHTML += "<br/>"+ received_msg;
       var element = document.getElementById("chatbox");
       element.scrollTop = element.scrollHeight;
    };
		
    ws.onclose = function()
    { 
       // websocket is closed.
       alert("Connection is closed...Please Reconnect...."); 
    };
 
		
	}
	
	function sendMessage(){
		
		message = document.getElementById("usermsg").value;
		to_user = document.getElementById("to_user").value;
		ws.send(to_user+":"+message);	
	}
     
    
	$(document).ready(function() {


	$('#usermsg').keydown(function(e) {
		var key = e.which;
		if (key == 13) {
		// As ASCII code for ENTER key is "13"
		$('#message_form').submit(); // Submit form code
		}
		});
	});
</script>

</head>
 <body>
<div id="wrapper">
    <div id="menu">
        <p class="welcome">Welcome, <b><label id="display_name"></label></b></p>
        <p class="welcome"><input type="text" id="user_name"/></p>
        <p class="logout"><a id="exit" href="javascript:connect()">Enter Chat</a></p>
        <div style="clear:both"></div>
    </div>
     
    <div id="chatbox"></div>
     
    <form id="message_form" action="javascript:sendMessage()">
    
    	<input name="to_user" type="text" id="to_user" placeholder="To User" size="12"/>
        <input name="usermsg" type="text" id="usermsg" size="63"  placeholder="Message" onk/>
       <!--  <input name="submitmsg" type="submit"  id="submitmsg" value="Send" /> --> 
    </form>
</div>
</body>
</html>
